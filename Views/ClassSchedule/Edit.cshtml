@model SchoolSystem.Models.ClassManagement.ClassSchedule
@{
    ViewData["Title"] = "Edit Schedule";
}

<div class="container mx-auto p-6">
    <h2 class="text-2xl font-bold mb-4 text-gray-700 text-center">
        Edit Class Schedule (CM_ID: @Model.CM_ID)
    </h2>

    <!-- ✅ แสดง Error Messages -->
    @if (!ViewData.ModelState.IsValid)
    {
        <div class="bg-red-100 text-red-700 p-3 mb-4 rounded">
            <strong>Errors:</strong>
            <ul>
                @foreach (var error in ViewData.ModelState.Values.SelectMany(v => v.Errors))
                {
                    <li>@error.ErrorMessage</li>
                }
            </ul>
        </div>
    }

    <form asp-action="Edit" method="post" class="bg-white p-6 shadow-md rounded-lg">
        <input type="hidden" asp-for="ScheduleID" />
        <input type="hidden" asp-for="CM_ID" />

        <div class="mb-4">
            <label asp-for="DayOfWeek" class="block font-medium">Day of Week</label>
            <select asp-for="DayOfWeek" class="w-full p-2 border rounded">
                <option value="Monday">Monday</option>
                <option value="Tuesday">Tuesday</option>
                <option value="Wednesday">Wednesday</option>
                <option value="Thursday">Thursday</option>
                <option value="Friday">Friday</option>
                <option value="Saturday">Saturday</option>
                <option value="Sunday">Sunday</option>
            </select>
        </div>

        <div class="mb-4">
            <label asp-for="StartTime" class="block font-medium">Start Time</label>
            <input asp-for="StartTime" type="time" class="w-full p-2 border rounded" required />
        </div>

        <div class="mb-4">
            <label asp-for="EndTime" class="block font-medium">End Time</label>
            <input asp-for="EndTime" type="time" class="w-full p-2 border rounded" required />
        </div>

        <div class="mb-4">
            <label asp-for="Status" class="block font-medium">Status</label>
            <select asp-for="Status" class="w-full p-2 border rounded">
                <option value="Active">Active</option>
                <option value="Inactive">Inactive</option>
            </select>
        </div>

        <div class="flex justify-between">
            <!-- ✅ ปุ่ม Save -->
            <button type="submit" class="bg-blue-500 text-white px-4 py-2 rounded hover:bg-blue-600">
                Save Changes
            </button>

            <!-- ✅ ปุ่ม Delete พร้อม Alert -->
            <button type="button" class="bg-red-600 text-white px-4 py-2 rounded hover:bg-red-500"
                    onclick="confirmDelete(@Model.ScheduleID)">
                Delete
            </button>
        </div>
    </form>
</div>

@section Scripts {
    <script>
        function confirmDelete(id) {
            if (confirm("Are you sure you want to delete this schedule?")) {
                fetch(`/ClassManagement/DeleteSchedule/${id}`, {
                    method: "POST",
                    headers: { "X-Requested-With": "XMLHttpRequest" }
                })
                .then(response => response.json())
                .then(data => {
                    if (data.success) {
                        alert("Schedule deleted successfully.");
                        window.location.href = "/ClassManagement/Index?deleted=true";
                    } else {
                        alert("Error deleting schedule.");
                    }
                });
            }
        }
    </script>
}
